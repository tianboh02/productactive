pipeline {
   agent any
    
   stages{
       stage('Build'){
           steps{
               echo 'Building stage...'
               echo "Running build ${env.BUILD_DISPLAY_NAME} on ${env.NODE_NAME} and JOB ${env.JOB_NAME}"
               echo "GIT_COMMIT is ${env.GIT_COMMIT}"
               bat """
        	   cd maven.productactive
        	   mvn clean install -DskipTests
        	   """
           }
       }
       stage('Test'){
           steps{
               echo 'Testing stage...'
    	       bat """
    	       cd maven.productactive
               mvn test
               """
           }
       }
       stage('Deploy'){
           steps{
               echo 'Deploying stage...'
               deploy adapters: [tomcat8(credentialsId: 'b81d407a-5b2e-403a-ac6b-a94ddeca12f3', path: '', url: 'http://localhost:8080')], contextPath: 'maven.productactive', onFailure: false, war: '**/*.war'
           }
       }
   }
   post{

       failure{
           mail body: """Dear Admin,

The following build ${env.BUILD_DISPLAY_NAME} on ${env.NODE_NAME} has encountered a build failure on ${env.BUILD_TIMESTAMP}. 
For more information about the current build, please visit ${env.BUILD_URL}

Regards,
Productactive@Jenkins""", subject: 'Productactive build failed', to: '2000303D@student.tp.edu.sg'
       }
       success{
           mail body: """Dear Admin,

The following build ${env.BUILD_DISPLAY_NAME} on ${env.NODE_NAME} has been successfully built on ${env.BUILD_TIMESTAMP}. 
For more information about the current build, please visit ${env.BUILD_URL}

Regards,
Productactive@Jenkins""", subject: 'Productactive build success', to: '2000303D@student.tp.edu.sg'
       }
   }
}